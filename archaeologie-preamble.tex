 \AtBeginDocument{\RecordChanges}
 \AtEndDocument{\PrintChanges}
\listfiles
\usepackage[oldstyle]{libertine}
\renewcommand*\ttdefault{lmvtt}

\usepackage{xr-hyper}

\usepackage[
	backend=biber,
%	backref,
	style=archaeologie,
	lstpublishers,
	lstlocations,
	lstabbrv,
%	initials=false,
]{biblatex}
\renewcommand\bibfont{\normalfont\footnotesize}
\usepackage{metalogo}
\usepackage{hologo}
\usepackage{babel}
\usepackage{coolthms}


\usepackage{chngcntr}

\usepackage[
  autostyle=true,%
]{csquotes}
\usepackage{multicol}
  \setlength{\columnsep}{1.5cm}
  \setlength{\columnseprule}{0.2pt}

\usepackage{xcolor}
\definecolor{codeblue}{RGB}{0,65,137}
\definecolor{codegreen}{RGB}{147,193,26}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}


\usepackage[ 
	headsepline, 
	footsepline,
%	plainfootsepline, 
%markcase=upper, 
automark, 
draft=false,
]{scrlayer-scrpage} 
\pagestyle{scrheadings}
\clearscrheadfoot
	\ihead{\normalfont\footnotesize \texttt{bib}\LaTeX-style \texttt{archaeologie \archaeologieversion} \copyright\ by Lukas C. Bossert | Johannes Friedl}%
\rofoot{\large\footnotesize  \textbf{\sffamily \thepage}}

\usepackage[%
%  flushmargin, %
%  marginal,
  ragged,%
  hang, %
  bottom%
]{footmisc} %Fussnoten



\usepackage{enumitem}
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 2pt}
\setenumerate[1]{label=(\alph*),leftmargin=*,nolistsep,parsep=\parskip}
\usepackage{changepage}
\makeindex

\defbibheading{empty}{}
\addbibresource{archaeologie-examples.bib}
%\usepackage{caption}

\usepackage[
  skins,
  listings,
  breakable
]{tcolorbox}
\lstMakeShortInline{|}

\newtcblisting[
  auto counter,
  list inside=bibexample,
%  number within=subsection,
  crefname={Example}{Examples}
]{bibexample}[2][]{%
  listing only,
  breakable,
  top=0.5pt,
  bottom=0.5pt,
  colback=codegreen!10,
  colframe=codegreen,
    left=5pt,
    right=5pt,
    sharp corners,
  boxrule=0pt,
  bottomrule=2pt,
  toprule=2pt,
  enhanced jigsaw,
  listing options={%style=tcblatex,
    numbers=left,
    numberstyle=\small\color{codeblue},
    moredelim={[is][keywordstyle]{@@}{@@}},
    basicstyle=\footnotesize\ttfamily,
    breaklines=true,
    breakautoindent=false,
    breakindent=0pt,
    escapeinside={{*@}{@*}},
  },%
  lefttitle=0pt,
  coltitle=black,
  colbacktitle=codegreen!20,
  fonttitle=\bfseries\footnotesize,
  title={Example \thetcbcounter:  #2}, 
  #1,%  
  borderline north={1pt}{14.4pt}{codegreen,dashed},
}

\newtcblisting[
auto counter,
%crefname={Example}{Examples}
]{code}{%
    listing only,
    breakable,
    top=0.2pt,
    bottom=0.2pt,
    colback=codegreen!10,
    colframe=codegreen,
    left=5pt,
    right=5pt,
      sharp corners,
    boxrule=0pt,
    bottomrule=0pt,
    toprule=0pt,
    enhanced jigsaw,
    listing options={%style=tcblatex,
%        numbers=left,
        numberstyle=\tiny\color{codeblue},
        moredelim={[is][keywordstyle]{@@}{@@}},
        basicstyle=\footnotesize\ttfamily,
        breaklines=true,
        breakautoindent=false,
        breakindent=0pt,
        escapeinside={{*@}{@*}},
    },%
    lefttitle=0pt,
    coltitle=codeblue,
    colbacktitle=codegreen!10,
%    fonttitle=\bfseries\footnotesize,
%    title={Example \thetcbcounter:  #2}, 
%   #1,%  
%    borderline north={1pt}{14.4pt}{codegreen,dashed},
}

\newtcolorbox{bibbox}[1]{
      breakable,
      top=5pt,
      bottom=5pt,
      colback=codeblue!10,
      colframe=codeblue,
      left=5pt,
      right=5pt,
        sharp corners,
      boxrule=0pt,
      bottomrule=2pt,
      toprule=2pt,
      enhanced jigsaw,
        lefttitle=0pt,
        coltitle=black,
        colbacktitle=codeblue!20,
        fonttitle=\bfseries\footnotesize,
  title={\Cref{#1}},
        borderline north={1pt}{14.4pt}{codeblue,dashed},
}


\newtcolorbox{marker}[1][]{
enhanced,
  before skip=2mm,after skip=3mm,
  boxrule=0.4pt,left=5mm,right=2mm,top=1mm,bottom=1mm,
  colback=backcolour,
  colframe=yellow!20!black,
  sharp corners,rounded corners=southeast,arc is angular,arc=3mm,
  underlay={%
    \path[fill=tcbcol@back!80!black] ([yshift=3mm]interior.south east)--++(-0.4,-0.1)--++(0.1,-0.2);
    \path[draw=tcbcol@frame,shorten <=-0.05mm,shorten >=-0.05mm] ([yshift=3mm]interior.south east)--++(-0.4,-0.1)--++(0.1,-0.2);
    \path[fill=red!50!black,draw=none] (interior.south west) rectangle node[white]{\Huge\bfseries !} ([xshift=4mm]interior.north west);
    },
  drop fuzzy shadow,#1
  }
  
\tcbset{examplebox/.style={%
              boxrule=0pt,
              bottomrule=2pt,
              toprule=2pt,
 colframe=codeblue,
  colback=codegreen!10,
   coltitle=codegreen!10,%  coltitle=codeblue,
  bicolor,
      sharp corners,
  colbacklower=codeblue!10,
  fonttitle=\sffamily\bfseries,
  }}



\newtcblisting{example}{%
    before skip=\baselineskip,
examplebox,
breakable,
%  sidebyside,
%%%%text and listing,
listing and text,
}

\newcommand{\printbib}[2][5em]{%
\begingroup
\begin{bibbox}{#2}
\begin{refsection}
\setlength{\labwidthsameline}{#1} 
\nocite{#2}
\printbibliography[heading=none]
\end{refsection}
\end{bibbox}
\endgroup
}

\newcommand{\printbiball}[2][5em]{%
\begingroup
\setlength{\labwidthsameline}{#1} 
\begin{bibbox}{#2}
\begin{itemize}
\begin{refsection}
\begin{footnotesize}
\nocite{#2}%
\item[English:]{\printbibliography[heading=none]}
\item[German:]\foreignlanguage{ngerman}{\printbibliography[heading=none]}
\item[Italian:]\foreignlanguage{italian}{\printbibliography[heading=none]}
\item[French:]\foreignlanguage{french}{\printbibliography[heading=none]}
\item[Spanish:]\foreignlanguage{spanish}{\printbibliography[heading=none]}
\end{footnotesize}
\end{refsection}
\end{itemize}%
\end{bibbox}
\endgroup
}






\usepackage{hyperxmp}
%\usepackage{hyperref}
\hypersetup{					% setup the hyperref-package options
	pdftitle={bib\LaTeX-archaeologie},	% 	- title (PDF meta)
	pdfsubject={This citation-style covers the citation and bibliography rules of the German Archaeological Institute. 
Various options are available to change and adjust the outcome according to one's own preferences. 
The style is compatible with the English, German, Italian, Spanish and French languages, since all bibstrings used are defined in each language.},% 	- subject (PDF meta)
	pdfauthor={Lukas C. Bossert, Johannes Friedl},	% 	- author (PDF meta)
	pdfauthortitle={},
	pdfcopyright={This work may be distributed and/or modified under the
conditions of the LaTeX Project Public License, either version 1.3
of this license or (at your option) any later version.},
	pdfhighlight=/N,
	pdfdisplaydoctitle=true,
	pdfdate={\the\year-\the\month-\the\day}
	pdflang={de},
	pdfcaptionwriter={Lukas C. Bossert},
	pdfkeywords={biblatex, archaeology, humanities},
%	pdfproducer={XeLaTeX},
	pdflicenseurl={http://www.latex-project.org/lppl.txt},
	plainpages=false,			% 	- 
  colorlinks   = true, %Colours links instead of ugly boxes
  urlcolor     =  codeblue, %Colour for external hyperlinks
  linkcolor    = codeblue, %Colour of internal links
  citecolor   = black, %Colour of citations
  	linktoc=page,
  	pdfborder={0 0 0},			% 	-
	breaklinks=true,			% 	- allow line break inside links
	bookmarksnumbered=true,		%
	bookmarksopenlevel=4,
	bookmarksopen=true,		%
	final=true	% = true, nur bei web-Dokument!! (wichtig!!)
}
\usepackage{bookmark}

\crefformat{lstlisting}{#2example\ #1#3}
\Crefformat{lstlisting}{#2Example #1#3}
\crefmultiformat{lstlisting}{#2examples #1#3}{; #2#1#3}{; #2#1#3}{; #2#1#3}
\Crefmultiformat{lstlisting}{#2Examples #1#3}{; #2#1#3}{; #2#1#3}{; #2#1#3}
\Crefrangeformat{lstlisting}{#3Examples #1#4--#5#2#6}
\crefrangeformat{lstlisting}{#3examples #1#4--#5#2#6}
